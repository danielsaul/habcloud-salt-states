# /etc/ntp.conf, configuration for ntpd; see ntp.conf(5) for help
driftfile /var/lib/ntp/ntp.drift

statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable

# Note that the firewall also blocks external traffic to NTP.
restrict -4 default ignore
restrict -6 default ignore

# Local users may issue ntpq queries
restrict 127.0.0.1 notrap nomodify nopeer
restrict ::1       notrap nomodify nopeer

{% if grains["host"] in ("ceto", "phorcys") %}
{% for fqdn in ("ntp1.metronet-uk.com", "ntp2.metronet-uk.com") %}
server   {{ fqdn }} minpoll 5 maxpoll 5 iburst prefer
restrict {{ fqdn }} kod notrap nomodify nopeer noquery
{% endfor %}
{% endif %}

{% for hostname in ("ceto", "phorcys") if grains["host"] != host %}
server   {{ hostname }}.private.habhub.org minpoll 5 iburst
restrict {{ hostname }}.private.habhub.org kod notrap nomodify nopeer noquery
{% endfor %}
