{% from "nginx/macros.jinja" import listen_addresses %}

server {
    {{ listen_addresses(port=http_port, ssl=False, default_server=True, use_x_forwarded=use_x_forwarded) }}
    {% if ssl %}
    {{ listen_addresses(port=ssl.port, ssl=True, default_server=True, use_x_forwarded=use_x_forwarded) }}
    {% endif %}

    server_name _; # serves requests that match nothing else

    {% if ssl %}
    ssl_certificate /etc/ssl/private/{{ ssl.certificate }}.crt;
    ssl_certificate_key /etc/ssl/private/{{ ssl.certificate }}.key;
    {% endif %}

    access_log syslog:server=unix:/dev/log,tag=nginx_catchall combined;
    error_log syslog:server=unix:/dev/log,tag=nginx_catchall,severity=warn;

    # Serve nginx status to localhost clients
    location /nginx_status {
        stub_status on;
        allow 127.0.0.1;
        deny all;
    }

    return 301 http://habhub.org/;
}
